<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Coordinate Systems - MapLibre Architecture</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../index.html"><strong aria-hidden="true">1.</strong> Intro</a></li><li class="chapter-item expanded affix "><li class="part-title">Architecture</li><li class="chapter-item expanded "><a href="../architecture/Collision-Detection.html"><strong aria-hidden="true">2.</strong> Collision Detection</a></li><li class="chapter-item expanded "><a href="../architecture/Threading-structure.html"><strong aria-hidden="true">3.</strong> Threading structure</a></li><li class="chapter-item expanded "><a href="../architecture/Expression-Architecture.html"><strong aria-hidden="true">4.</strong> Expression Architecture</a></li><li class="chapter-item expanded "><a href="../architecture/Text-Rendering.html"><strong aria-hidden="true">5.</strong> Text Rendering</a></li><li class="chapter-item expanded affix "><li class="part-title">Rendering</li><li class="chapter-item expanded "><a href="../rendering/Coordinate-Systems.html" class="active"><strong aria-hidden="true">6.</strong> Coordinate Systems</a></li><li class="chapter-item expanded "><a href="../rendering/OpenGL-Docs.html"><strong aria-hidden="true">7.</strong> OpenGL Docs</a></li><li class="chapter-item expanded affix "><li class="part-title">Android</li><li class="chapter-item expanded "><a href="../android/Setting-up-Mapbox-checkstyle.html"><strong aria-hidden="true">8.</strong> Setting up Mapbox checkstyle</a></li><li class="chapter-item expanded "><a href="../android/Android-5.x-to-6.x-migration-guide.html"><strong aria-hidden="true">9.</strong> Android 5.x to 6.x migration guide</a></li><li class="chapter-item expanded "><a href="../android/Android-6.x-to-7.x-migration-guide.html"><strong aria-hidden="true">10.</strong> Android 6.x to 7.x migration guide</a></li><li class="chapter-item expanded "><a href="../android/Getting-line-numbers-from-an-Android-crash-with-ndk-stack.html"><strong aria-hidden="true">11.</strong> Getting line numbers from an Android crash with ndk stack</a></li><li class="chapter-item expanded "><a href="../android/Android-4.x-to-5.x-migration-guide.html"><strong aria-hidden="true">12.</strong> Android 4.x to 5.x migration guide</a></li><li class="chapter-item expanded "><a href="../android/Strategies-to-reduce-Android-APK-size.html"><strong aria-hidden="true">13.</strong> Strategies to reduce Android APK size</a></li><li class="chapter-item expanded affix "><li class="part-title">Apple</li><li class="chapter-item expanded "><a href="../apple/GPUs.html"><strong aria-hidden="true">14.</strong> GPUs</a></li><li class="chapter-item expanded "><a href="../apple/Upgrading-from-Mapbox-Maps-SDK-for-iOS-v3.7.x-to-v4.0.x.html"><strong aria-hidden="true">15.</strong> Upgrading from Mapbox Maps SDK for iOS v3.7.x to v4.0.x</a></li><li class="chapter-item expanded affix "><li class="part-title">Releasing</li><li class="chapter-item expanded "><a href="../releasing/Merge-release-branch-into-master.html"><strong aria-hidden="true">16.</strong> Merge release branch into master</a></li><li class="chapter-item expanded "><a href="../releasing/Releasing-the-Mapbox-macOS-SDK.html"><strong aria-hidden="true">17.</strong> Releasing the Mapbox macOS SDK</a></li><li class="chapter-item expanded "><a href="../releasing/Releasing-the-Mapbox-iOS-SDK.html"><strong aria-hidden="true">18.</strong> Releasing the Mapbox iOS SDK</a></li><li class="chapter-item expanded affix "><li class="part-title">Workflow</li><li class="chapter-item expanded "><a href="../workflow/JS-Native-workflow.html"><strong aria-hidden="true">19.</strong> JS Native workflow</a></li><li class="chapter-item expanded "><a href="../workflow/Code-Structure.html"><strong aria-hidden="true">20.</strong> Code Structure</a></li><li class="chapter-item expanded "><a href="../workflow/Versions-and-tagging.html"><strong aria-hidden="true">21.</strong> Versions and tagging</a></li><li class="chapter-item expanded "><a href="../workflow/Troubleshooting.html"><strong aria-hidden="true">22.</strong> Troubleshooting</a></li><li class="chapter-item expanded "><a href="../workflow/Building-with-Xcode.html"><strong aria-hidden="true">23.</strong> Building with Xcode</a></li><li class="chapter-item expanded affix "><li class="part-title">Misc</li><li class="chapter-item expanded "><a href="../misc/Release-notes-style-guide.html"><strong aria-hidden="true">24.</strong> Release notes style guide</a></li><li class="chapter-item expanded "><a href="../misc/Using-Mapbox-iOS-SDK-in-an-Interface-Builder-storyboard.html"><strong aria-hidden="true">25.</strong> Using Mapbox iOS SDK in an Interface Builder storyboard</a></li><li class="chapter-item expanded "><a href="../misc/Terminology-across-platforms.html"><strong aria-hidden="true">26.</strong> Terminology across platforms</a></li><li class="chapter-item expanded "><a href="../misc/Release-notes-template-for-macOS.html"><strong aria-hidden="true">27.</strong> Release notes template for macOS</a></li><li class="chapter-item expanded "><a href="../misc/Prototyping-with-Framer.js.html"><strong aria-hidden="true">28.</strong> Prototyping with Framer</a></li><li class="chapter-item expanded "><a href="../misc/Prerelease-notes-template-for-macOS.html"><strong aria-hidden="true">29.</strong> Prerelease notes template for macOS</a></li><li class="chapter-item expanded "><a href="../misc/Bitrise-workflow-details.html"><strong aria-hidden="true">30.</strong> Bitrise workflow details</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">MapLibre Architecture</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="mapbox-gl-coordinate-systems"><a class="header" href="#mapbox-gl-coordinate-systems">Mapbox GL Coordinate Systems</a></h1>
<blockquote>
<p><strong>TL;DR:</strong> Unsure how a point on a map gets transformed from a WGS84 latitude/longitude into x and y coordinates of a pixel on your screen? <del>Love matrix math</del> Willing to skim past a bunch of math? Read on… </p>
<p>Just want to see some of the guts of Mapbox GL without any context? Check out the <a href="https://chrisloer.github.io/mapbox-gl-coordinates">coordinate transformation demo I made</a></p>
</blockquote>
<p>For the last two months, I've been working on <a href="https://github.com/mapbox/mapbox-gl-js/pull/4547">making labels easier to read on pitched maps</a>, and as my first time really working with 3D graphics, it's been a crash course in trigonometry and linear algebra. The work brought back a surprising number of pleasant memories from high school trig class, and made me grateful for all the teachers (from Mr. Hatter twenty years ago to our local math teacher <a href="https://github.com/anandthakker">@anandthakker</a> today) who have worked to prepare me for this job!</p>
<p>3D graphics are <a href="https://learnopengl.com/#!Getting-started/Coordinate-Systems">all about transforming points between different coordinate systems</a>, and as I followed our code to figure out how our transformations worked, I kept getting tripped up because I didn't realize which coordinate system the code was using. In this devlog, I'm trying to answer the question I didn't know I needed to ask when I started: what coordinate systems do we use in Mapbox GL to turn a bunch of points defined by latitude and longitude into a bunch of points with pixel x and y coordinates on your screen?</p>
<p>If you’re working directly on Mapbox GL code, this is important stuff to know: otherwise, these implementation details are for the most part mercifully hidden.</p>
<p>I'll start where @lyzidiamond's <a href="https://github.com/mapbox/hey/issues/6314">awesome devlog on projections and coordinate systems</a> left off: WGS84 latitude and longitude.</p>
<h2 id="wheres-the-washington-monument"><a class="header" href="#wheres-the-washington-monument">Where's the Washington Monument?</a></h2>
<p>Let's follow how one point gets transformed through our different coordinate systems. The Washington Monument is located at approximately <code>(longitude: -77.035915, latitude: 38.889814)</code> in the WGS84 coordinate system. What happens if we ask Mapbox GL to draw a cat at just that point?</p>
<p><img src="./google-made-this-easy.jpg" alt="google made this easy" /></p>
<p>There are five coordinate systems we'll move through:</p>
<ul>
<li>WGS84</li>
<li>World Coordinates</li>
<li>Tile Coordinates</li>
<li>GL Coordinates</li>
<li>Screen Coordinates/NDC</li>
</ul>
<p><strong>Projecting WGS84 to Web Mercator/&quot;World Coordinates&quot;</strong>
As <a href="https://github.com/lyzidiamond">@lyzidiamond</a> pointed out, computers love squares, so our first step is to take those spherical coordinates and turn them into coordinates on a rectangular 2D world (aka a &quot;Pseudo-Mercator Projection&quot;). Our particular projection imagines the world as a giant grid of pixels with the size:</p>
<pre><code>worldSize = tileSize * number of tiles across one dimension
</code></pre>
<p>We use a tile size of <code>512</code> (roughly: this means a tile is 512 pixels square, although that would only be true at the base zoom level and without any pitch). I'll assume we're rendering tiles at zoom level <code>11</code> (which means there are <code>2^11</code> tile positions across both dimensions). That gives us:</p>
<pre><code>worldSize = 512 * 2^11 = 1048576
</code></pre>
<p>Then getting an x coordinate is easy, we just shift by 180˚ (because we start with x=0 at -180˚) and multiply by the world size:</p>
<pre><code>x coord = (180˚ + longitude) / 360˚ * worldSize 
        = (180˚ + -77.035915˚) / 360˚ * 1048576
        = 299,904
</code></pre>
<p>For the y coordinate, we apply the <a href="https://en.wikipedia.org/wiki/Web_Mercator">funky y stretch that is Web Mercator</a>:</p>
<pre><code>y = ln(tan(45˚ + latitude / 2))
  = ln(tan(45˚ + 38.889814˚ / 2))
  = 0.73781742861
y coord = (180˚ - y * (180 / π)) / 360˚ * worldSize
        = (180˚ - 42.27382˚) / 360˚ * 1048576
        = 401,156
</code></pre>
<p>OK, so <code>(x: 299904, y: 401156)</code> may be a great internal representation, but it's awkward and you have to know what zoom level it applies to. We can represent the same world coordinate by storing the zoom level and dividing the x and y components by the tile size. Our Washington Monument coordinate then becomes: <code>(585.7471, 783.5067, z11)</code>. One nice thing about storing coordinates this way is that it's really simple to transform them to different zoom levels.</p>
<p><img src="https://d2mxuefqeaa7sj.cloudfront.net/s_0240CF0C8C6EAE4CE3E50E3DFEF825E2238C6126BE7AB9B1C6F141A68979605B_1497564253787_Washington+Monument+World+Coordinates.png" alt="world coordinates" /></p>
<p><strong>Web Mercator -&gt; Tile Coordinates</strong>
Now we're making progress, because we have almost exactly what we need to ask the server for a tile that contains this point: we just drop the sub-integer precision and ask for <code>(585/783/11)</code>.</p>
<p>If we're drawing a vector tile, it will have geometry data for all the things on the map that we need to draw <em>around</em> our Washington Monument Cat. The <a href="https://github.com/mapbox/vector-tile-spec/tree/master/2.1#41-layers">Mapbox vector tile spec</a> specifies that tiles should have a defined <code>extent</code> that they use internally for coordinates. For a tile with an <code>extent</code> of 1024, <code>(0,0)</code> would be the top left corner of the tile and <code>(1024,1024)</code> would be on the bottom right.</p>
<p>Whatever tile coordinates come in, Mapbox GL internally normalizes to an <code>extent</code> of 8192 — since our tiles are (kind of) 512 pixels wide, that means our tile coordinates have a precision of 512/8192 = 1/16th of a pixel. To represent our Washington Monument coordinates in tile coordinates, we just multiply the remainder by the extent, so:</p>
<pre><code>(x: 585.7471, y: 783.5067, zoom: 11)
</code></pre>
<p>Becomes:</p>
<pre><code>Tile: 585/783/11
Tile Coordinates: (.7471 * 8192, .5067 * 8192) = (x: 6120, y: 4151)
</code></pre>
<p><img src="https://d2mxuefqeaa7sj.cloudfront.net/s_0240CF0C8C6EAE4CE3E50E3DFEF825E2238C6126BE7AB9B1C6F141A68979605B_1497564323856_Washington+Monument+Tile+Coordinates.png" alt="tile coordinates" /></p>
<p><strong>Tile Coordinates -&gt; 4D GL Coordinates</strong>
When Mapbox GL loads a map tile, it pulls together all the data for the tile and turns it into a representation the GPU can understand. In general, the representation we give to the GPU is specified in tile coordinates — the advantage here is that we only have to build the tile once, but then we can ask the GPU to quickly draw the same tile with different bearing, pitch, zoom, and pan parameters.</p>
<p>The code we have that runs on the GPU is called a &quot;shader&quot;: it takes tile coordinate inputs and outputs four dimensional &quot;GL Coordinates&quot; in the form <code>(x, y, z, w)</code>. Wait, four dimensions? Don't worry, it's just for doing math.</p>
<p><code>x</code> and <code>y</code> are pretty straightforward left/right and up/down. <code>z</code> is only slightly trickier: it represents position along an axis directly orthogonal to your screen. <code>w</code> is the more mysterious component, but it's necessary for generating the &quot;perspective&quot; effect: you can think of it as a &quot;scaling&quot; parameter for the other components, or as a measure of how far away they are from the viewer. When we draw labels, it's very useful to know the <code>w</code> component of a point, because it gives us a measure of how large the items around us will be (a higher <code>w</code> value means the perspective projection will make everything around our point smaller when it ultimately displays on the screen).</p>
<p>Converting from tile coordinates to GL coordinates involves applying a lot of &quot;transformations&quot; to the coordinates: one to apply perspective, one to move the imaginary camera away from the map, one to center the map, one to rotate the map, one to pitch the map, etc. Each one of these transformations can be represented as a 4D matrix, and all of the matrices can be combined into one matrix that applies all the transformations in one mathematical operation. These transformations build on top of some pixel-based parameters (size of the viewport, idealized size of tile) so we sometimes talk about the resulting coordinates as &quot;pixel&quot; coordinates although it's a fairly indirect connection. You might also see this coordinate system referred to as <a href="https://en.wikipedia.org/wiki/Clip_coordinates">&quot;clip space&quot;</a>.</p>
<p>Let's see what that looks like for a very specific view of our map. Note that each tile has its own projection matrix: before going into GL coordinates, we first have to go back from tile coordinates to world coordinates so that the points from different tiles all have the same frame of reference.</p>
<pre><code>Zoom level: 11.6
Map Center: 38.891/-77.0822 (over Washington DC)
Bearing: -23.2 degrees
Pitch: 45 degrees
Viewport dimensions: 862 by 742 pixels
Tile: 585/783/11 (covering a portion of Washington DC)
</code></pre>
<p>Gives a transformation matrix of:</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>x</th><th>y</th><th>z</th><th>w</th></tr></thead><tbody>
<tr><td>x</td><td>0.224</td><td>-0.079</td><td>-0.026</td><td>-0.026</td></tr>
<tr><td>y</td><td>-0.096</td><td>-0.184</td><td>-0.062</td><td>-0.061</td></tr>
<tr><td>z</td><td>0.000</td><td>0.108</td><td>-0.036</td><td>-0.036</td></tr>
<tr><td>w</td><td>-503.244</td><td>1071.633</td><td>1469.955</td><td>1470.211</td></tr>
</tbody></table>
</div>
<p>There's way too much to unpack there in one devlog, but if you want to look at all the individual transformations to get a feel for how they fit together to make a 3D projection, and how they change as you move around the map, check out this <a href="https://chrisloer.github.io/mapbox-gl-coordinates">GL coordinate transformation demo I made</a>.</p>
<p>To get from tile coordinates to GL coordinates, we just turn the tile coordinates into a 4D vector with a z-value of 0 (ignoring buildings for now, sorry <a href="https://github.com/lbud">@lbud</a>!) and &quot;neutral&quot; w-value of 1. We then <a href="https://en.wikipedia.org/wiki/Transformation_matrix">apply the transformation matrix</a> to get our GL coordinate, so:</p>
<pre><code>(x: 6120, y: 4151, z: 0, w: 1)
</code></pre>
<p>Becomes:</p>
<div class="table-wrapper"><table><thead><tr><th></th><th>x</th><th>y</th><th>z</th><th>w</th></tr></thead><tbody>
<tr><td>input x = 6120</td><td>0.224 * 6120 = 1370.88</td><td>-0.079 * 6120 = -483.48</td><td>-0.026 * 6120 = -159.12</td><td>-0.026 * 6120 = -159.12</td></tr>
<tr><td>input y = 4151</td><td>-0.096 * 4151 = -398.496</td><td>-0.184 * 4151 = -763.784</td><td>-0.062 * 4151 = -257.362</td><td>-0.061 * 4151 = 253.311</td></tr>
<tr><td>input z = 0</td><td>0.000 * 0 = 0</td><td>0.108 * 0 = 0</td><td>-0.036 * 0 = 0</td><td>-0.036 * 0 = 0</td></tr>
<tr><td>input w = 1</td><td>-503.244 * 1 = -503.244</td><td>1071.633 * 1 = 1071.633</td><td>1469.955 * 1 = 1469.955</td><td>1470.211 * 1 = 1470.211</td></tr>
<tr><td><strong>Output (Summed)</strong></td><td>469.14</td><td>-175.631</td><td>1053.473</td><td>1057.78</td></tr>
</tbody></table>
</div>
<p>😬 (yikes, the numbers don’t exactly match up with the machine output below! My excuse is that I did the math by hand at low precision…)</p>
<pre><code>(x: 472.1721, y: -177.8471, z: 1052.9670, w: 1053.7176)
</code></pre>
<p><img src="https://d2mxuefqeaa7sj.cloudfront.net/s_0240CF0C8C6EAE4CE3E50E3DFEF825E2238C6126BE7AB9B1C6F141A68979605B_1497564431838_Washington+Monument+GL+Coordinates.png" alt="gl coordinates" /></p>
<p>When you pan/rotate/tilt our map and it animates at a smooth 60 fps, what's happening is that we're changing the transformation matrix and then passing that modified matrix to the GPU, which does a massively parallel (and mind-bogglingly fast) application of that transformation matrix to all the points it needs to draw.</p>
<p><strong>4D GL Coordinates -&gt; 2D Pixels on your screen</strong>
Our shader code is done once it outputs GL Coordinates, but OpenGL still does some more work to turn the coordinates into pixel locations on your screen.</p>
<p>First, it transforms to &quot;Normalized Device Coordinates&quot; by dividing the <code>x, y, z</code> components of the GL Coordinate by the <code>w</code> component. The resulting values look like:</p>
<pre><code>x: -1,1 --&gt; left to right of viewport
y: -1,1 --&gt; bottom to top of viewport
z: -1,1 --&gt; depth (not directly visible)
</code></pre>
<p>Any values outside of the range <code>[-1,1]</code> indicate points that are off the screen — they are (kind of) thrown away. You can see that another way to think of <code>w</code> is as &quot;the bounds of what coordinates are visible at this distance&quot;.</p>
<p>In our example, the GL Coordinates:</p>
<pre><code>     (x: 472.1721, y: -177.8471, z: 1052.9670, w: 1053.7176)
</code></pre>
<p>Become NDC:</p>
<pre><code>        (472.1721 / 1053.72, -177.8471 / 1053.72, 1052.9670 / 1053.72)
     -&gt; (x: 0.4481, y: -0.1688, z: 0.9993)
</code></pre>
<p>The z-value of NDC doesn't affect the 2D pixel coordinates. Instead, it's used for combining multiple layers (for instance, a bridge drawn over a river). The z-value tells the GPU which points are &quot;in front&quot; of other points: for opaque layers only the frontmost layer will show, but for translucent layers the z-order can be used for blending. Actually, I don't really know what I'm talking about here: ask <a href="https://github.com/lbud">@lbud</a>!</p>
<p>Finally, OpenGL translates NDC to pixel coordinates based on the size of the viewport:</p>
<p><img src="https://d2mxuefqeaa7sj.cloudfront.net/s_0240CF0C8C6EAE4CE3E50E3DFEF825E2238C6126BE7AB9B1C6F141A68979605B_1497630299136_NDC+Sketch.jpg" alt="NDC to pixel" /></p>
<p>In our case, the viewport is 862x742 pixels, so:</p>
<pre><code> Pixel Coordinates: (NDC.x * width + width / 2, height / 2 - NDC.y * height)
                  = (0.4481 * 862 + 431, 371 - (-0.1688 * 742))
                  = (x: 624, y: 434)
</code></pre>
<p>🎉 </p>
<p><img src="https://d2mxuefqeaa7sj.cloudfront.net/s_0240CF0C8C6EAE4CE3E50E3DFEF825E2238C6126BE7AB9B1C6F141A68979605B_1497564013914_Washington+Monument+Screen+Coordinates.png" alt="screen coordinates" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../architecture/Text-Rendering.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../rendering/OpenGL-Docs.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../architecture/Text-Rendering.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../rendering/OpenGL-Docs.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
